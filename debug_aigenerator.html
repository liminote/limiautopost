<!DOCTYPE html>
<html>
<head>
    <title>AIGenerator Debug Test</title>
</head>
<body>
    <h1>Debug AIGenerator localStorage</h1>
    <button onclick="checkLocalStorage()">檢查 localStorage</button>
    <button onclick="clearLocalStorage()">清除 localStorage</button>
    <button onclick="testSaveLoad()">測試保存載入</button>
    
    <div id="output"></div>

    <script>
        const TEMPLATES = [
            {
                id: 'template-1',
                title: '生活體悟',
                platform: 'threads',
                features: '分享生活感悟、個人成長、心靈啟發',
                prompt: '請嚴格遵守以下規則生成 Threads 第一則貼文：...'
            }
        ];

        function checkLocalStorage() {
            const saved = localStorage.getItem('aigenerator_templates');
            const output = document.getElementById('output');
            
            if (saved) {
                const parsed = JSON.parse(saved);
                output.innerHTML = '<h3>localStorage 內容:</h3><pre>' + JSON.stringify(parsed, null, 2) + '</pre>';
            } else {
                output.innerHTML = '<h3>localStorage 是空的</h3>';
            }
        }

        function clearLocalStorage() {
            localStorage.removeItem('aigenerator_templates');
            document.getElementById('output').innerHTML = '<h3>已清除 localStorage</h3>';
        }

        function testSaveLoad() {
            // 模擬保存過程
            const testData = {
                'template-1': {
                    id: 'template-1',
                    platform: 'instagram',
                    title: '測試標題',
                    features: '測試功能',
                    prompt: '測試提示詞',
                    updatedAt: new Date().toISOString()
                }
            };
            
            localStorage.setItem('aigenerator_templates', JSON.stringify(testData));
            
            // 模擬載入過程
            const localSaved = localStorage.getItem('aigenerator_templates');
            const localTemplates = JSON.parse(localSaved);
            
            const updatedTemplates = TEMPLATES.map(template => {
                const localTemplate = localTemplates[template.id];
                if (localTemplate) {
                    return {
                        ...template,
                        platform: localTemplate.platform !== undefined ? localTemplate.platform : template.platform,
                        title: localTemplate.title !== undefined ? localTemplate.title : template.title,
                        features: localTemplate.features !== undefined ? localTemplate.features : template.features,
                        prompt: localTemplate.prompt !== undefined ? localTemplate.prompt : template.prompt
                    };
                }
                return template;
            });
            
            const output = document.getElementById('output');
            output.innerHTML = `
                <h3>測試結果:</h3>
                <p><strong>原始模板標題:</strong> ${TEMPLATES[0].title}</p>
                <p><strong>localStorage 中的標題:</strong> ${localTemplates['template-1'].title}</p>
                <p><strong>合併後的標題:</strong> ${updatedTemplates[0].title}</p>
                <pre>合併後的完整模板: ${JSON.stringify(updatedTemplates[0], null, 2)}</pre>
            `;
        }
    </script>
</body>
</html>
